# A population analogue of the Allen-Cahn equation

We'd like to do an analogue of
$$
    \partial_t n(t, x) = \partial_x^2 \left(n(t, x)\right) + n(t,x) (1 - n(t, x)) (2n(t,x) - 1 + s),
$$
for some $s \in (0,2)$.
To do this, if the death, birth, and establishment rates are $\mu$, $\gamma$, and $r$ respectively, since
$$
    \partial_t n(t, x) = r(x, t) \partial_x^2 \left(\gamma(x, t) n(t, x)\right) + n(t,x) \left(\gamma(x, t) - \mu(x, t)\right) ,
$$
we'll set $r(x, t) = \gamma(x,t) = 1$, and rescale by carrying capacity so that $n(x, t) = N(x, t) / K$,
and so we need $\gamma - \mu = (1 - n) (2n - 1 + s)$, so
$$\begin{aligned}
    \mu(x, t)
        &= 1 - (1 - n(x,t)) (2n(x,t) - 1 + s) \\
        &= 1 - (1 - N(x,t)/K) (2N(x,t)/K - 1 + s) .
\end{aligned}$$
To check: at equilibrium, $\mu = \gamma$, which happens when $N = K$.
We expect to recover the deterministic equation (sometimes?) when $K \to \infty$.

*However*, we're working in discrete time,
and death probabilities must be positive, so let's adjust this.

Reproduction will be Poisson, so here's the actual curves:
```{r plot_curves, fig.width=10, fig.height=10}
dt <- 0.1
K <- 20
mu <- function (N, K, s) { 
                rate <- 1 - (1 - N/K) * (2 * N / K - 1 + s)
                return(1 - exp(- dt * rate))
     }
gamma <- function(...) {
    return(1 - exp(-dt))
}
layout(matrix(1:4, nrow=2, byrow=TRUE))
for (s in c(0.01, 0.2, 0.5, 1.0)) {
    x <- data.frame(N=1:(2*K))
    x$mu <- mu(x$N, K, s)
    x$gamma <- gamma(x$N, K)
    x$diff <- x$gamma - x$mu
    matplot(x$N, as.matrix(x[,c('mu', 'gamma', 'diff')]), type='l', lty=1,
            xlab='N', ylab='per capita number',
            main=sprintf("s=%f", s))
    legend('topleft', lty=1, col=1:3, legend=c('mu', 'gamma', 'diff'))
    abline(v=K, lty=3)
}
```

Each individual:

1. produces a single offspring with probability $1 - exp(-dt)$, and then
2. dies with probability $1 - \exp(-dt \mu)$.

```{r per_capita}
s <- 0.1
layout(t(1:2))
for (K in c(20, 200)) {
    next_gen <- function(N, K) {
        offspring <- rbinom(length(N), size=N, prob=gamma(N, K))
        survivors <- rbinom(length(N), size=N, prob=1 - mu(N, K, s))
        return(offspring + survivors)
    }
    Nmat <- matrix(NA, nrow=100, ncol=30)
    Nmat[1,] <- 1.5 * K * (1:ncol(Nmat)) / ncol(Nmat)
    for (k in 2:nrow(Nmat)) {
        Nmat[k, ] <- next_gen(Nmat[k-1,], K)
    }
    matplot(Nmat, type='l',
        ylab='number of individuals',
        xlab='time',
        main=sprintf("K = %d, s=%0.2f", K, s)
    )
}
```

